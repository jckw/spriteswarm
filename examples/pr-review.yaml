# AI reviews PRs and posts feedback
id: pr-review

description: |
  When a PR is opened, Claude checks out the code, reviews it,
  and posts feedback directly to the PR.

sprite:
  name: code-reviewer
  path: claude
  cmd: "-p"
  workdir: /home/user/repo

source:
  type: github
  events:
    - pull_request

match:
  - payload.action == "opened"
  - payload.pull_request.draft == false

run: |
  Review this PR and post your feedback to GitHub.

  PR #{{payload.pull_request.number}}: {{payload.pull_request.title}}
  Author: {{payload.pull_request.user.login}}

  First, fetch and checkout the PR:
    git fetch origin pull/{{payload.pull_request.number}}/head:pr-{{payload.pull_request.number}}
    git checkout pr-{{payload.pull_request.number}}

  Then review:
  1. Run 'git diff main' to see the changes
  2. Review for:
     - Bugs or logic errors
     - Security issues
     - Performance concerns
     - Code style consistency
  3. If you find issues, post a review with specific line comments using the GitHub CLI
  4. If it looks good, approve with a brief summary of what the PR does
